<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="An interest calculator using Chart.js">
    <meta name="author" content="Donovan Maas">

    <title>Interest Calculator</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.2.1/chart.umd.min.js" integrity="sha512-GCiwmzA0bNGVsp1otzTJ4LWQT2jjGJENLGyLlerlzckNI30moi2EQT0AfRI7fLYYYDKR+7hnuh35r3y1uJzugw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B1ELNH44BM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-B1ELNH44BM');
        // Disable Ad Tracking
        gtag('set', 'allow_google_signals', false);
        // Disable Ad Personalization on this site.
        gtag('set', 'allow_ad_personalization_signals', false);
    </script>

    <style>
        canvas {
            width: 100%;
            height: auto;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <div class="container">
                    <div class="d-flex p-2">
                        <h1>Interest Calculator</h1>
                    </div>  
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="container">
                    <hr>
                    <form>
                        <div class="row">
                            <div class="col col-12 col-sm-12 col-md">
                                <div class="mb-4">
                                    <label id="principleInputLabel" for="principleInput" class="form-label">Principle</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="text" class="form-control" id="principleInput" aria-labelledby="principleInputLabel" value="1000" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <input type="range" class="form-range" id="principleRangeInput" aria-labelledby="principleInputLabel" value="1000" min="0" max="5000000" required>
                                </div>
                                <div class="mb-3">
                                    <label id="contributionInputLabel" for="contributionInput" class="form-label">Annual Contribution</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="text" class="form-control" id="contributionInput" aria-labelledby="contributionInputLabel" value="12000" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <input type="range" class="form-range" id="contributionRangeInput" aria-labelledby="contributionInputLabel" value="12000" min="0" max="250000" required>
                                </div>
                            </div>
                            <div class="col col-12 col-sm col-md">
                                <div class="mb-3">
                                    <label id="interestInputLabel" for="interestInput" class="form-label">Annual Interest Rate</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="interestInput" aria-labelledby="interestInputLabel" value="8" required>
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="interestDeviationInputLabel" for="interestDeviationInput" class="form-label">Interest Deviation</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="interestDeviationInput" aria-labelledby="interestDeviationInputLabel" value="2" required>
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label id="contributionIncreasePercentInputLabel" for="contributionIncreasePercentInput" class="form-label">Contribution Increase Per Year</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="contributionIncreasePercentInput" aria-labelledby="contributionIncreasePercentInputLabel" value="5" required>
                                        <span class="input-group-text">%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col col-12 col-sm col-md">
                                <div class="mb-3">
                                    <label id="yearsInputLabel" for="yearsInput" class="form-label">Years</label>
                                    <input type="text" class="form-control" id="yearsInput" aria-labelledby="yearsInputLabel" value="40" required>
                                </div>
                            </div>
                        </div>
                    </form>
                    <hr>
                    <div class="d-flex p-2">
                        <canvas id="interestGraph"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            "use strict";
            window.addEventListener("load", function() {
                const interestGraphCanvas = document.getElementById("interestGraph");

                const principleInput = document.getElementById("principleInput");
                const principleRangeInput = document.getElementById("principleRangeInput");
                const contributionInput = document.getElementById("contributionInput");
                const contributionRangeInput = document.getElementById("contributionRangeInput");
                const contributionIncreasePercentInput = document.getElementById("contributionIncreasePercentInput");
                const interestInput = document.getElementById("interestInput");
                const interestDeviationInput = document.getElementById("interestDeviationInput");
                const yearsInput = document.getElementById("yearsInput");

                const chart = new Chart(
                    interestGraphCanvas,
                    {
                        type: "line",
                        options: {

                        },
                        data: {
                            labels: [
                                1, 2, 3, 4, 5
                            ],
                            datasets: [
                                {
                                    label: "Positive Deviation Over Time",
                                    data: [ 10000, 110000, 1210000, 13310000, 14641000 ],
                                    tension: 0.3
                                },
                                {
                                    label: "Valulation Over Time",
                                    data: [ 10000, 110000, 1210000, 13310000, 14641000 ],
                                    tension: 0.3
                                },
                                {
                                    label: "Negative Deviation Over Time",
                                    data: [ 10000, 110000, 1210000, 13310000, 14641000 ],
                                    tension: 0.3
                                }
                            ]
                        }
                    }
                );

                function updateChartWithDeviation() {
                    const principle = principleInput.value * 1;
                    let contribution = contributionInput.value * 1;
                    const interest = 1 + (interestInput.value / 100.0);
                    const interestDeviation = interestDeviationInput.value / 100.0;
                    const interestAbove = interest + interestDeviation;
                    const interestBelow = interest - interestDeviation;
                    const contributionInterest = 1 + (contributionIncreasePercentInput.value / 100.0);
                    const years = yearsInput.value|0;

                    let currentValueAbove = principle;
                    let currentValue = principle;
                    let currentValueBelow = principle;

                    console.log("Principle:", principle);
                    console.log("Contribution:", contribution);
                    console.log("Interest Above:", interestAbove);
                    console.log("Interest:", interest);
                    console.log("Interest Below:", interestBelow);
                    console.log("Contribution Interest:", contributionInterest);
                    console.log("Years:", years);

                    for(let i = 0; i <= years; ++i)
                    {
                        chart.data.labels.push(i);
                        chart.data.datasets[0].data.push(currentValueAbove);
                        chart.data.datasets[1].data.push(currentValue);
                        chart.data.datasets[2].data.push(currentValueBelow);

                        currentValueAbove += contribution;
                        currentValue += contribution;
                        currentValueBelow  += contribution;

                        currentValueAbove *= interestAbove;
                        currentValue *= interest;
                        currentValueBelow *= interestBelow;

                        contribution *= contributionInterest;
                    }
                }

                function updateChartWithoutDeviation() {
                    const principle = principleInput.value * 1;
                    let contribution = contributionInput.value * 1;
                    const interest = 1 + (interestInput.value / 100.0);
                    const interestDeviation = interestDeviationInput.value / 100.0;
                    const contributionInterest = 1 + (contributionIncreasePercentInput.value / 100.0);
                    const years = yearsInput.value|0;

                    let currentValue = principle;

                    console.log("Principle:", principle);
                    console.log("Contribution:", contribution);
                    console.log("Interest:", interest);
                    console.log("Contribution Interest:", contributionInterest);
                    console.log("Years:", years);

                    for(let i = 0; i <= years; ++i)
                    {
                        chart.data.labels.push(i);
                        chart.data.datasets[0].data.push(currentValue);

                        currentValue += contribution;
                        currentValue *= interest;

                        contribution *= contributionInterest;
                    }
                }

                function updateChart() {
                    const principle = principleInput.value * 1;
                    let contribution = contributionInput.value * 1;
                    const interest = 1 + (interestInput.value / 100.0);
                    const interestDeviation = interestDeviationInput.value / 100.0;
                    const interestAbove = interest + interestDeviation;
                    const interestBelow = interest - interestDeviation;
                    const contributionInterest = 1 + (contributionIncreasePercentInput.value / 100.0);
                    const years = yearsInput.value|0;

                    chart.data.labels = [ ];

                    if(interestDeviationInput.value != 0)
                    {
                        chart.data.datasets = [
                            {
                                label: "Positive Deviation Over Time",
                                data: [ ],
                                tension: 0.3
                            },
                            {
                                label: "Valulation Over Time",
                                data: [ ],
                                tension: 0.3
                            },
                            {
                                label: "Negative Deviation Over Time",
                                data: [ ],
                                tension: 0.3
                            }
                        ];

                        updateChartWithDeviation();
                    }
                    else
                    {
                        chart.data.datasets = [
                            {
                                label: "Valulation Over Time",
                                data: [ ],
                                tension: 0.3
                            }
                        ];

                        updateChartWithoutDeviation();
                    }

                    chart.update();
                }

                updateChart();

                principleInput.addEventListener("input", event => {
                    principleRangeInput.value = principleInput.value;
                    updateChart();
                });

                principleRangeInput.addEventListener("input", event => {
                    principleInput.value = principleRangeInput.value;
                    updateChart();
                });

                contributionInput.addEventListener("input", event => {
                    contributionRangeInput.value = contributionInput.value;
                    updateChart();
                });

                contributionRangeInput.addEventListener("input", event => {
                    contributionInput.value = contributionRangeInput.value;
                    updateChart();
                });

                interestInput.addEventListener("input", event => {
                    updateChart();
                });

                interestDeviationInput.addEventListener("input", event => {
                    updateChart();
                });

                contributionIncreasePercentInput.addEventListener("input", event => {
                    updateChart();
                });

                yearsInput.addEventListener("input", event => {
                    updateChart();
                });
            });
        })();
    </script>
</body>
</html>
